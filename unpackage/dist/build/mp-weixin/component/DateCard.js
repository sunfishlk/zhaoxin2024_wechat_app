"use strict";const e=require("../common/vendor.js"),o=require("../utils/log.js"),a={__name:"DateCard",props:{dateProps:String},emits:["exit","hide"],setup(a,{emit:t}){const l=a,n=getApp().globalData.baseUrl,c=e.ref({month:"",day:""}),s=e.ref("八月"),u=e.ref(!1),d=e.ref(!0),r=e.ref(!1),i=e.ref(!0),v=[1,2,3],g=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],h=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],f=[29,30],b=()=>{console.log("nextPage"),s.value="九月",u.value=!0,d.value=!1,r.value=!0,i.value=!1},p=()=>{console.log("lastPage"),s.value="八月",u.value=!1,d.value=!0,r.value=!1,i.value=!0},m=(e,o)=>""===e||""===o?"":`${e<10?"0"+e:e}-${o<10?"0"+o:o}`,w=(e,o)=>P.value.includes(m(e,o))?"black":_.value.includes(m(e,o))?"red":"",k=e=>{const o=new Date(e),a=o.getMonth()+1,t=o.getDate();c.value.month=a,c.value.day=t,8===a?(s.value="八月",r.value=!1,i.value=!0,u.value=!1,d.value=!0):9===a&&(s.value="九月",i.value=!1,r.value=!0,u.value=!0,d.value=!1)},x=(o,a)=>{"black"===w(o,a)?(c.value.month=o,c.value.day=a,console.log("chooseDate"),console.log(o),console.log(a),t("exit",o,a)):"red"===w(o,a)?(((e,o)=>{const a=new Date,t=a.getMonth()+1,l=a.getDate();return t>e||t===e&&l>o})(o,a)?e.index.showToast({title:"该日期已过期，请选择其他日期",icon:"none",duration:1e3}):e.index.showToast({title:"该日期已被预约满，请选择其他日期",icon:"none",duration:1e3}),console.log("cannot choose")):console.log("cannot choose")},D=(e,o)=>c.value.month===e&&c.value.day===o;e.watch((()=>l.dateProps),(e=>{e&&k(e)}));let y=e.index.getStorageSync("cookie");const P=e.ref([]),_=e.ref([]);return e.onMounted((()=>{console.log("onShow"),l.dateProps&&k(l.dateProps),e.index.request({url:`${n}/api/student/date`,method:"GET",header:{"Content-Type":"application/json",Cookie:y},success:e=>{o.log.info({responseData:e}),console.log(e);for(let o=0;o<e.data.data.length;o++)0!==e.data.data[o].available?P.value.push(e.data.data[o].date.substring(5)):_.value.push(e.data.data[o].date.substring(5));console.log(P.value),console.log(_.value)},fail:o=>{console.log(o),e.index.showToast({title:JSON.stringify(o),icon:"none"})}})})),(o,a)=>({a:e.o((e=>o.$emit("hide"))),b:e.f(v,((o,a,t)=>({a:e.t(o),b:a,c:e.s({color:w(8,o)}),d:e.s({"background-color":D(8,o)?"#eecfd3":"white"}),e:e.o((e=>x(8,o)),a)}))),c:e.f(g,((o,a,t)=>({a:e.t(o),b:a,c:e.s({color:w(8,o)}),d:e.s({"background-color":D(8,o)?"#eecfd3":"white"}),e:e.o((e=>x(8,o)),a)}))),d:e.n({"hide-center":u.value}),e:e.f(h,((o,a,t)=>({a:e.t(o),b:a,c:e.s({color:w(9,o)}),d:e.s({"background-color":D(9,o)?"#eecfd3":"white"}),e:e.o((e=>x(9,o)),a)}))),f:e.f(f,((o,a,t)=>({a:e.t(o),b:a,c:e.s({color:w(9,o)}),d:e.s({"background-color":D(9,o)?"#eecfd3":"white"}),e:e.o((e=>x(9,o)),a)}))),g:e.n({"hide-center":d.value}),h:e.t("<"),i:e.n({"un-clickable":!r.value}),j:e.o(p),k:e.t(s.value),l:e.t(">"),m:e.n({"un-clickable":!i.value}),n:e.o(b)})}},t=e._export_sfc(a,[["__scopeId","data-v-be6e8757"]]);wx.createComponent(t);
